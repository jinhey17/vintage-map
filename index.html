<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¹ˆí‹°ì§€ ë³´ë¬¼ì§€ë„</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    #map { width: 100%; height: calc(100vh - 64px); margin-top: 64px; }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 50;
    }
    .bottom-sheet {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
      transition: transform 0.3s ease-out;
      z-index: 100;
    }
    .bottom-sheet.closed { transform: translateY(calc(100% - 80px)); }
    .bottom-sheet.open { transform: translateY(30%); }
    .handle {
      width: 40px;
      height: 4px;
      background: #d1d5db;
      border-radius: 2px;
      margin: 12px auto;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .filter-chip {
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid #e5e7eb;
      background: white;
      cursor: pointer;
      margin: 4px;
    }
    .filter-chip.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: flex-end;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      width: 100%;
      border-radius: 20px 20px 0 0;
      max-height: 90vh;
      overflow-y: auto;
    }
    .detail-page {
      position: fixed;
      inset: 0;
      background: white;
      z-index: 2000;
      overflow-y: auto;
    }
    .photo-slide {
      height: 250px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="map"></div>

  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ddb2d2fdd091b40e8df161e74dbc3aeb"></script>
  
  <script>
    // í˜ì´ì§€ ë¡œë“œ í›„ ì§€ë„ ì´ˆê¸°í™”
    window.onload = function() {
      var container = document.getElementById('map');
      var options = {
        center: new kakao.maps.LatLng(37.5400, 126.9700),
        level: 8
      };
      var map = new kakao.maps.Map(container, options);
      
      // ì „ì—­ìœ¼ë¡œ ì €ì¥
      window.kakaoMap = map;
      window.kakaoMapReady = true;
      
      // ë§ˆì»¤ ë°ì´í„°
      var stores = [
        { id: 1, name: 'ë ˆíŠ¸ë¡œí•˜ìš°ìŠ¤', address: 'ì„œìš¸ ë§ˆí¬êµ¬ ì›”ë“œì»µë¡œ 123', lat: 37.5565, lng: 126.9224 },
        { id: 2, name: 'ë¹ˆí‹°ì§€ì•¤ëª¨ì–´', address: 'ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 456', lat: 37.5000, lng: 127.0280 },
        { id: 3, name: 'ì˜¬ë“œìŠ¤ì¿¨ë¹ˆí‹°ì§€', address: 'ì„œìš¸ ë§ˆí¬êµ¬ ì™€ìš°ì‚°ë¡œ 94', lat: 37.5536, lng: 126.9234 },
        { id: 4, name: 'ì•„ë¦„ë‹¤ìš´ê°€ê²Œ ê°•ë‚¨ì ', address: 'ì„œìš¸ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ 789', lat: 37.5172, lng: 127.0473 },
        { id: 5, name: 'ë³´ë¬¼ì°½ê³ ', address: 'ì„œìš¸ ìš©ì‚°êµ¬ ì´íƒœì›ë¡œ 234', lat: 37.5345, lng: 126.9944 }
      ];
      
      // ë§ˆì»¤ ìƒì„±
      stores.forEach(function(store) {
        var marker = new kakao.maps.Marker({
          position: new kakao.maps.LatLng(store.lat, store.lng),
          map: map
        });
        
        var infowindow = new kakao.maps.InfoWindow({
          content: '<div style="padding:10px;font-size:14px;"><strong>' + store.name + '</strong><br>' + store.address + '</div>'
        });
        
        kakao.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map, marker);
        });
      });
    };
  </script>

  <script type="text/babel">
    const { useState } = React;

    const sampleStores = [
      { id: 1, name: 'ë ˆíŠ¸ë¡œí•˜ìš°ìŠ¤', address: 'ì„œìš¸ ë§ˆí¬êµ¬ ì›”ë“œì»µë¡œ 123', phone: '02-1234-5678', hours: '12:00 - 21:00 (ì›”ìš”ì¼ íœ´ë¬´)', storeTypes: ['luxury', 'select'], disposal: ['buyback', 'donation_receipt'], styles: ['americana', 'classic'], gender: 'unisex', amenities: { fitting: true, restroom: true, parking: false }, rating: 4.5, reviewCount: 23, distance: 'ë„ë³´ 5ë¶„' },
      { id: 2, name: 'ë¹ˆí‹°ì§€ì•¤ëª¨ì–´', address: 'ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 456', phone: '02-2345-6789', hours: '11:00 - 20:00 (ì—°ì¤‘ë¬´íœ´)', storeTypes: ['kilo'], disposal: ['donation_receipt'], styles: ['street', 'japanese'], gender: 'female', amenities: { fitting: true, restroom: false, parking: true }, rating: 4.2, reviewCount: 45, distance: 'ë„ë³´ 12ë¶„' },
      { id: 3, name: 'ì˜¬ë“œìŠ¤ì¿¨ë¹ˆí‹°ì§€', address: 'ì„œìš¸ ë§ˆí¬êµ¬ ì™€ìš°ì‚°ë¡œ 94', phone: '02-3456-7890', hours: '13:00 - 22:00', storeTypes: ['select'], disposal: ['buyback'], styles: ['americana', 'street'], gender: 'male', amenities: { fitting: true, restroom: true, parking: false }, rating: 4.7, reviewCount: 67, distance: 'ë„ë³´ 3ë¶„' },
      { id: 4, name: 'ì•„ë¦„ë‹¤ìš´ê°€ê²Œ ê°•ë‚¨ì ', address: 'ì„œìš¸ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ 789', phone: '02-4567-8901', hours: '10:00 - 19:00', storeTypes: ['social'], disposal: ['donation_receipt', 'donation'], styles: ['classic'], gender: 'unisex', amenities: { fitting: false, restroom: true, parking: true }, rating: 4.3, reviewCount: 89, distance: 'ë„ë³´ 8ë¶„' },
      { id: 5, name: 'ë³´ë¬¼ì°½ê³ ', address: 'ì„œìš¸ ìš©ì‚°êµ¬ ì´íƒœì›ë¡œ 234', phone: '02-5678-9012', hours: '12:00 - 21:00 (í™”ìš”ì¼ íœ´ë¬´)', storeTypes: ['kilo'], disposal: ['buyback'], styles: ['japanese', 'street'], gender: 'female', amenities: { fitting: true, restroom: false, parking: false }, rating: 4.6, reviewCount: 34, distance: 'ë„ë³´ 15ë¶„' }
    ];

    const storeTypeLabels = {
      luxury: { emoji: 'ğŸ’', label: 'ëª…í’ˆ/í•˜ì´ì—”ë“œ' },
      select: { emoji: 'ğŸ§¢', label: 'ì…€ë ‰íŠ¸ìƒµ' },
      kilo: { emoji: 'âš–ï¸', label: 'í‚¬ë¡œ/ì°½ê³ í˜•' },
      social: { emoji: 'ğŸ€', label: 'ì‚¬íšŒì ê¸°ì—…' }
    };

    const disposalLabels = {
      donation_receipt: { emoji: 'ğŸ§¾', label: 'ê¸°ë¶€(ì˜ìˆ˜ì¦O)' },
      donation: { emoji: 'ğŸ', label: 'ê¸°ë¶€(ì˜ìˆ˜ì¦X)' },
      buyback: { emoji: 'ğŸ’°', label: 'ë§¤ì…ê°€ëŠ¥' }
    };

    const styleLabels = {
      americana: { emoji: 'ğŸ‡ºğŸ‡¸', label: 'ì•„ë©”ì¹´ì§€' },
      japanese: { emoji: 'ğŸ‘—', label: 'ì¼ë³¸/í˜ë¯¸ë‹Œ' },
      street: { emoji: 'ğŸ›¹', label: 'ìŠ¤íŠ¸ë¦¿/Y2K' },
      classic: { emoji: 'ğŸ‘”', label: 'í´ë˜ì‹' }
    };

    function FilterModal({ isOpen, onClose, filters, setFilters }) {
      if (!isOpen) return null;

      const toggleFilter = (category, value) => {
        setFilters(prev => {
          const current = prev[category] || [];
          if (current.includes(value)) {
            return { ...prev, [category]: current.filter(v => v !== value) };
          } else {
            return { ...prev, [category]: [...current, value] };
          }
        });
      };

      const activeCount = Object.values(filters).flat().length;

      return (
        <div className="modal" onClick={onClose}>
          <div className="modal-content" onClick={e => e.stopPropagation()}>
            <div style={{ position: 'sticky', top: 0, background: 'white', borderBottom: '1px solid #e5e7eb', padding: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <button onClick={onClose} style={{ fontSize: '24px', border: 'none', background: 'none', cursor: 'pointer' }}>â†</button>
              <h2 style={{ fontWeight: 'bold', fontSize: '18px' }}>í•„í„°</h2>
              <button onClick={() => setFilters({})} style={{ color: '#3b82f6', border: 'none', background: 'none', cursor: 'pointer' }}>ì´ˆê¸°í™”</button>
            </div>

            <div style={{ padding: '16px' }}>
              <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>ğŸ›ï¸ ë§¤ì¥ ì„±ê²©</h3>
              <div style={{ display: 'flex', flexWrap: 'wrap', marginBottom: '24px' }}>
                {Object.entries(storeTypeLabels).map(([key, { emoji, label }]) => (
                  <div key={key} className={`filter-chip ${filters.storeTypes?.includes(key) ? 'active' : ''}`} onClick={() => toggleFilter('storeTypes', key)}>
                    <span style={{ marginRight: '8px' }}>{emoji}</span>{label}
                  </div>
                ))}
              </div>

              <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>â™»ï¸ ì˜· ì²˜ë¶„ ê°€ëŠ¥í•œ ê³³</h3>
              <div style={{ display: 'flex', flexWrap: 'wrap', marginBottom: '24px' }}>
                {Object.entries(disposalLabels).map(([key, { emoji, label }]) => (
                  <div key={key} className={`filter-chip ${filters.disposal?.includes(key) ? 'active' : ''}`} onClick={() => toggleFilter('disposal', key)}>
                    <span style={{ marginRight: '8px' }}>{emoji}</span>{label}
                  </div>
                ))}
              </div>

              <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>ğŸ’¡ ìŠ¤íƒ€ì¼</h3>
              <div style={{ display: 'flex', flexWrap: 'wrap', marginBottom: '24px' }}>
                {Object.entries(styleLabels).map(([key, { emoji, label }]) => (
                  <div key={key} className={`filter-chip ${filters.styles?.includes(key) ? 'active' : ''}`} onClick={() => toggleFilter('styles', key)}>
                    <span style={{ marginRight: '8px' }}>{emoji}</span>{label}
                  </div>
                ))}
              </div>
            </div>

            <div style={{ position: 'sticky', bottom: 0, background: 'white', borderTop: '1px solid #e5e7eb', padding: '16px' }}>
              <button onClick={onClose} style={{ width: '100%', background: '#3b82f6', color: 'white', padding: '12px', borderRadius: '8px', fontWeight: 'bold', border: 'none', cursor: 'pointer' }}>
                ì ìš©í•˜ê¸° {activeCount > 0 && `(${activeCount})`}
              </button>
            </div>
          </div>
        </div>
      );
    }

    function DetailPage({ store, onClose }) {
      if (!store) return null;

      return (
        <div className="detail-page">
          <div style={{ position: 'sticky', top: 0, background: 'white', borderBottom: '1px solid #e5e7eb', padding: '16px', display: 'flex', alignItems: 'center', zIndex: 10 }}>
            <button onClick={onClose} style={{ fontSize: '24px', marginRight: '16px', border: 'none', background: 'none', cursor: 'pointer' }}>â†</button>
            <h1 style={{ fontWeight: 'bold', fontSize: '18px' }}>{store.name}</h1>
          </div>

          <div className="photo-slide">ğŸª</div>

          <div style={{ padding: '16px' }}>
            <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px' }}>{store.name}</h2>
            <div style={{ display: 'flex', alignItems: 'center', marginBottom: '16px' }}>
              <span style={{ color: '#eab308', marginRight: '4px' }}>â­</span>
              <span style={{ fontWeight: '600', marginRight: '4px' }}>{store.rating}</span>
              <span style={{ color: '#6b7280' }}>(ë¦¬ë·° {store.reviewCount}ê°œ)</span>
            </div>

            <div style={{ marginBottom: '24px' }}>
              <p>ğŸ“ {store.address}</p>
              <p>ğŸ• {store.hours}</p>
              <p>ğŸ“ {store.phone}</p>
            </div>

            <hr style={{ margin: '24px 0' }} />

            <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>ğŸ›ï¸ ë§¤ì¥ ì„±ê²©</h3>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '24px' }}>
              {store.storeTypes.map(type => (
                <span key={type} style={{ padding: '4px 12px', background: '#f3f4f6', borderRadius: '9999px', fontSize: '14px' }}>
                  {storeTypeLabels[type].emoji} {storeTypeLabels[type].label}
                </span>
              ))}
            </div>

            <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>â™»ï¸ ì˜· ì²˜ë¶„í•˜ê¸°</h3>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '24px' }}>
              {store.disposal.map(d => (
                <span key={d} style={{ padding: '4px 12px', background: '#f0fdf4', color: '#15803d', borderRadius: '9999px', fontSize: '14px' }}>
                  {disposalLabels[d].emoji} {disposalLabels[d].label}
                </span>
              ))}
            </div>

            <h3 style={{ fontWeight: 'bold', marginBottom: '12px' }}>ğŸ¢ í¸ì˜ì‹œì„¤</h3>
            <div style={{ display: 'flex', gap: '16px', marginBottom: '24px' }}>
              <span>{store.amenities.fitting ? 'âœ…' : 'âŒ'} í”¼íŒ…ë£¸</span>
              <span>{store.amenities.restroom ? 'âœ…' : 'âŒ'} í™”ì¥ì‹¤</span>
              <span>{store.amenities.parking ? 'âœ…' : 'âŒ'} ì£¼ì°¨</span>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '8px', margin: '24px 0' }}>
              <button style={{ padding: '12px', border: '1px solid #e5e7eb', borderRadius: '8px', background: 'white', cursor: 'pointer' }}>ğŸ“ ê¸¸ì°¾ê¸°</button>
              <button style={{ padding: '12px', border: '1px solid #e5e7eb', borderRadius: '8px', background: 'white', cursor: 'pointer' }} onClick={() => window.open(`tel:${store.phone}`)}>ğŸ“ ì „í™”</button>
              <button style={{ padding: '12px', border: '1px solid #e5e7eb', borderRadius: '8px', background: 'white', cursor: 'pointer' }}>ğŸ”— ê³µìœ </button>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [isBottomSheetOpen, setIsBottomSheetOpen] = useState(false);
      const [isFilterOpen, setIsFilterOpen] = useState(false);
      const [filters, setFilters] = useState({});
      const [selectedStore, setSelectedStore] = useState(null);

      const filteredStores = sampleStores.filter(store => {
        if (filters.storeTypes?.length && !filters.storeTypes.some(f => store.storeTypes.includes(f))) return false;
        if (filters.disposal?.length && !filters.disposal.some(f => store.disposal.includes(f))) return false;
        if (filters.styles?.length && !filters.styles.some(f => store.styles.includes(f))) return false;
        return true;
      });

      const activeFilterCount = Object.values(filters).flat().length;

      return (
        <>
          <div className="header">
            <h1 style={{ fontSize: '20px', fontWeight: 'bold', cursor: 'pointer', margin: 0 }} onClick={() => { setIsBottomSheetOpen(false); setFilters({}); setSelectedStore(null); }}>
              ğŸ—ºï¸ ë¹ˆí‹°ì§€ ë³´ë¬¼ì§€ë„
            </h1>
            <button onClick={() => setIsFilterOpen(true)} style={{ position: 'relative', padding: '8px 16px', border: '1px solid #e5e7eb', borderRadius: '8px', background: 'white', cursor: 'pointer' }}>
              ğŸ›ï¸ í•„í„°
              {activeFilterCount > 0 && (
                <span style={{ position: 'absolute', top: '-4px', right: '-4px', background: '#3b82f6', color: 'white', fontSize: '12px', width: '20px', height: '20px', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  {activeFilterCount}
                </span>
              )}
            </button>
          </div>

          <div className={`bottom-sheet ${isBottomSheetOpen ? 'open' : 'closed'}`}>
            <div style={{ cursor: 'pointer' }} onClick={() => setIsBottomSheetOpen(!isBottomSheetOpen)}>
              <div className="handle"></div>
              {!isBottomSheetOpen && (
                <div style={{ textAlign: 'center', paddingBottom: '16px', fontWeight: '600' }}>
                  ëª©ë¡ ì—´ê¸° ({filteredStores.length}ê°œ)
                </div>
              )}
            </div>

            {isBottomSheetOpen && (
              <div style={{ overflowY: 'auto', maxHeight: 'calc(70vh - 60px)' }}>
                <div style={{ textAlign: 'center', padding: '8px 0', fontWeight: '600', borderBottom: '1px solid #e5e7eb' }}>
                  ë§¤ì¥ {filteredStores.length}ê°œ
                </div>
                
                {filteredStores.map(store => (
                  <div key={store.id} className="card" onClick={() => setSelectedStore(store)}>
                    <h3 style={{ fontWeight: 'bold', fontSize: '18px', marginBottom: '8px' }}>ğŸª {store.name}</h3>
                    <p style={{ color: '#4b5563', fontSize: '14px', marginBottom: '8px' }}>ğŸ“ {store.address} Â· {store.distance}</p>
                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '8px' }}>
                      {store.storeTypes.map(type => (
                        <span key={type} style={{ fontSize: '12px', padding: '2px 8px', background: '#f3f4f6', borderRadius: '4px' }}>
                          {storeTypeLabels[type].emoji} {storeTypeLabels[type].label}
                        </span>
                      ))}
                      {store.disposal.slice(0, 2).map(d => (
                        <span key={d} style={{ fontSize: '12px', padding: '2px 8px', background: '#f0fdf4', color: '#15803d', borderRadius: '4px' }}>
                          {disposalLabels[d].emoji} {disposalLabels[d].label}
                        </span>
                      ))}
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center' }}>
                      <span style={{ color: '#eab308', marginRight: '4px' }}>â­</span>
                      <span style={{ fontWeight: '600', marginRight: '4px' }}>{store.rating}</span>
                      <span style={{ color: '#6b7280', fontSize: '14px' }}>({store.reviewCount})</span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <FilterModal isOpen={isFilterOpen} onClose={() => setIsFilterOpen(false)} filters={filters} setFilters={setFilters} />
          
          {selectedStore && <DetailPage store={selectedStore} onClose={() => setSelectedStore(null)} />}
        </>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
